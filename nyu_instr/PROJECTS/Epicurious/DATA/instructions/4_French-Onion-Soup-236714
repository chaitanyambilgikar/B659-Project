Cook onions, thyme, bay leaves, and salt in butter in a 4- to 5-quart heavy pot over moderate heat, uncovered, stirring frequently, until onions are very soft and deep golden brown, about 45 minutes. Add flour and cook, stirring, 1 minute. Stir in wine and cook, stirring, 2 minutes. Stir in broth, water, and pepper and simmer, uncovered, stirring occasionally, 30 minutes.
While soup simmers, put oven rack in middle position and preheat oven to 350°F.
Arrange bread in 1 layer on a large baking sheet and toast, turning over once, until completely dry, about 15 minutes.
Remove croûtes from oven and preheat broiler. Put crocks in a shallow baking pan.
Discard bay leaves and thyme from soup and divide soup among crocks, then float a croûte in each. Slice enough Gruyère (about 6 ounces total) with cheese plane to cover tops of crocks, allowing ends of cheese to hang over rims of crocks, then sprinkle with Parmigiano-Reggiano.
Broil 4 to 5 inches from heat until cheese is melted and bubbly, 1 to 2 minutes.
