In a large bowl soak the noodles in cold water to cover for 30 minutes, or until they are softened, and drain them well. In a small bowl stir together the fish sauce, the ketchup, the vinegar, the brown sugar, and the cayenne.
In a wok or non-stick skillet heat 1 tablespoon of the oil over moderate heat until it is hot but not smoking, add the eggs, and cook them, stirring, until they are scrambled and just cooked through. Transfer the eggs to a bowl and break them into pieces with a spoon.
In the wok or a large heavy skillet heat the remaining 2 tablespoons oil over moderately high heat until it just begins to smoke and in it stir-fry the garlic and the shallots until the mixture is golden. Add the shrimp and stir-fry the mixture 1 to 2 minutes, or until the shrimp are just cooked through. Add the ketchup mixture, the noodles, 2 cups of the bean sprouts, the scallions, and the water and cook the mixture, stirring, for 3 to 5 minutes, or until the noodles are tender and the excess liquid is evaporated. Add the egg, toss the mixture well, and mound it on a platter.
Sprinkle the noodle mixture with the peanuts and the red pepper flakes and arrange the remaining 1 cup bean sprouts around it. Garnish the dish with the chilies, the coriander sprigs, and the lime wedges.
