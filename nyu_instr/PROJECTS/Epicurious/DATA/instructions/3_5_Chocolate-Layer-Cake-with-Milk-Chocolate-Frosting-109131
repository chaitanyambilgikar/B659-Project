Make cake: Put oven rack in middle position and preheat oven to 350°F. Butter 2 (9- by 2-inch) round cake pans and line bottom of each with a round of parchment or wax paper. Butter paper and dust pans with flour, knocking out excess.
Sift together flour, cocoa, baking soda, and salt into a small bowl. Beat together butter and sugars in a large bowl using an electric mixer at medium-high speed until light and fluffy, 3 to 4 minutes in a standing mixer or 4 to 5 minutes with a handheld. Add eggs 1 at a time, beating well after each addition. Add chocolate and vanilla and beat until just combined. Reduce speed to low and add flour mixture and buttermilk alternately in 3 batches, beginning and ending with flour mixture and mixing until just combined.
Divide batter between cake pans, spreading evenly, and bake until a wooden pick or skewer inserted in center of each cake layer comes out clean, 25 to 35 minutes.
Cool cake layers in pans on racks 10 minutes. Run a thin knife around edge of each layer, then invert onto racks. Peel off paper and cool layers completely.
Make frosting: Heat milk in a 1- to 1 1/2-quart heavy saucepan over moderate heat until hot. Whisk together yolks, flour, 1/3 cup confectioners sugar, and a pinch of salt in a bowl, then add hot milk in a stream, whisking. Transfer custard to saucepan and bring to a boil over moderate heat, whisking. Reduce heat and simmer, whisking, 2 minutes (mixture will be very thick), then transfer to a large bowl. Cover surface of custard with a buttered round of wax paper and cool completely, about 45 minutes.
Add vanilla and remaining cup confectioners sugar to custard and beat with cleaned beaters at moderate speed until combined well, then increase speed to medium-high and beat in butter, 2 tablespoons at a time, until smooth. Add chocolates and beat until combined well.
Frost cake: Halve each cake layer horizontally using a long serrated knife. Layer cake, using a heaping 1/2 cup frosting between each layer, then frost top and sides with remaining frosting.
