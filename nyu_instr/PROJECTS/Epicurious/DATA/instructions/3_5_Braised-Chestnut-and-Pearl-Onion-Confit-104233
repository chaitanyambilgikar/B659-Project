Blanch onions in a large saucepan of boiling water 3 minutes, then drain and transfer to a bowl of ice and cold water. Drain onions and peel.
Cook chestnuts in 3 tablespoons butter in a large saucepan over moderately low heat, stirring occasionally, 2 minutes. Add broth and celery and cook at a bare simmer, stirring occasionally, until liquid is reduced to about 1/4 cup, about 10 minutes.
While chestnuts are cooking, heat remaining 3 tablespoons butter in a 10-inch heavy skillet over moderately high heat until foam subsides, then sauté shallots and peeled onions with thyme and salt and pepper to taste, stirring, until onions are tender and golden brown in patches. Add wine and simmer until slightly reduced, about 2 minutes.
Gently stir onion mixture into chestnut mixture and season with salt and pepper.
