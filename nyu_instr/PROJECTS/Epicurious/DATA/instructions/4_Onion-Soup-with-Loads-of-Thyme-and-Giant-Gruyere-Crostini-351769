In a heavy 5-quart pot melt the butter over low heat. Add the onions, thyme, bay leaf, and salt and pepper to taste and cook until the onions are deep amber and exceedingly soft, stirring occasionally, 25 to 30 minutes. Add the flour and cook for 1 to 2 minutes, then add the wine, increase the heat, and let the wine bubble away for 2 to 3 minutes. Add the beef stock and water, and let the soup simmer for 25 to 30 minutes, allowing the flavors to meld together. Season with salt and pepper to taste.
Preheat the oven to broil. Arrange a rack in the middle of the oven.
Place the ciabatta on the middle rack of the oven and toast until crispy, about 2 to 3 minutes per side.
Remove the bay leaf and thyme sprigs from the soup and discard. Pour the soup into two ovenproof bowls, float the toasted ciabatta on top, and cover it with a thick layer of the Gruyère. Put the soup bowls under the broiler on the middle rack and cook 3 to 5 minutes, or until the cheese is fully melted and golden.
